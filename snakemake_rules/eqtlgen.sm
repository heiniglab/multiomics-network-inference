#------------------------------------------------------------------------------
# Collect range information per sentinel snp (snp genes, connecting genes, 
# eqtl genes etc)
#------------------------------------------------------------------------------
rule collect_ranges_egen:
        input:
                eqtl="data/current/eqtl_gen/trans-eQTL_significant_20181017.txt.gz",
                ppi=PPI_DB,
                tfbs_annot="results/current/tfbs_tss_annot.rds"
        output:
                DRANGES + "{sentinel}_eqtlgen.rds"
        log:
                "logs/collect_ranges_egen/{sentinel}.log"
        benchmark:
                "benchmarks/collect_ranges_egen/{sentinel}.bmk"
        threads: 1
        resources:
                mem_mb=2300
        script:
                "../scripts/collect_ranges_eqtl.R"

# -----------------------------------------------------------------------------
# Target rule to generate all hotspot ranges collections for eqtl gen and to 
# create a summary plot.
# -----------------------------------------------------------------------------
#TEMP = glob_wildcards(DRANGES + "{sentinel}_eqtlgen.rds")
rule eqtlgen_locus_summary:
	input:
		expand(DRANGES + "{sentinel}_eqtlgen.rds", sentinel=EQTLGEN_ALL["sentinel"])
	output:
		DRANGES + "eqtlgen_summary.pdf"
	script:
		"../scripts/create_locus_summary_eqtlgen.R"

# -----------------------------------------------------------------------------
# Annotate TSS with TFBS information
# -----------------------------------------------------------------------------
rule annotate_tss_with_tf:
        input:
                tfbs_remap="data/current/tfbs/filPeaks_public.bed",
                tfbs_encode="data/current/tfbs/wgEncodeRegTfbsClusteredWithCellsV3.bed"
        output:
                tfbs_annot="results/current/tfbs_tss_annot.rds"
        script:
                "../scripts/annotate_tss_with_tf.R"

